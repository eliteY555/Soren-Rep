"use strict";(self["webpackChunkzhenyitong_online_medical"]=self["webpackChunkzhenyitong_online_medical"]||[]).push([[336],{9336:function(t,e,r){r.r(e),r.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"records-container"},[e("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"records-card"},[e("div",{staticClass:"card-header"},[e("div",{staticClass:"header-left"},[e("h2",[t._v("咨询列表")]),e("div",{staticClass:"header-decoration"},[e("span",{staticClass:"decoration-line"}),e("span",{staticClass:"decoration-dot"})])]),e("div",{staticClass:"decorative-icon"},[e("img",{staticClass:"decorative-pattern",attrs:{src:r(4305),alt:"装饰图案"}})])]),t._l(t.recordList,(function(r){return e("div",{key:r.recordId},[e("el-descriptions",{staticClass:"record-description",staticStyle:{"margin-bottom":"20px"},attrs:{column:3,border:""}},[e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-user"}),t._v(" 姓名 ")]),t._v(" "+t._s(r.patientName)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-mobile-phone"}),t._v(" 手机号 ")]),t._v(" "+t._s(r.phone)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-time"}),t._v(" 年龄 ")]),t._v(" "+t._s(r.age)+" ")],2),e("el-descriptions-item",{attrs:{contentStyle:{width:"350px"}}},[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-tickets"}),t._v(" 病症详情 ")]),e("span",{staticClass:"text-ellipsis"},[t._v(t._s(r.description))])],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-tickets"}),t._v(" 所属科室 ")]),t._v(" "+t._s(r.departmentName)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-service"}),t._v(" 诊治医生 ")]),t._v(" "+t._s(r.doctorName)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-notebook-1"}),t._v(" 病历状态 ")]),0==r.status?e("el-tag",{attrs:{size:"small",type:"info"}},[t._v("未查看")]):t._e(),1==r.status?e("el-tag",{attrs:{size:"small",type:"warning"}},[t._v("已查看")]):t._e(),2==r.status?e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("已诊断")]):t._e(),3==r.status?e("el-tag",{attrs:{size:"small",type:"primary"}},[t._v("诊断已结束")]):t._e(),e("el-link",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.goRecordDetail(r.recordId)}}},[t._v("点击查看详情")])],2)],1)],1)})),0===t.recordList.length?e("el-empty",{attrs:{description:"暂无咨询记录"}}):t._e(),t.recordList.length>0?e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[5,10,20,50,100],"current-page":t.tableParams.page,"page-size":t.tableParams.pageSize,total:t.total},on:{"current-change":e=>t.handleQuery({page:e}),"size-change":e=>t.handleQuery({pageSize:e})}})],1):t._e()],2),t._m(0)],1)},a=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"floating-patterns"},[e("div",{staticClass:"floating-pattern pattern1"}),e("div",{staticClass:"floating-pattern pattern2"}),e("div",{staticClass:"floating-pattern pattern3"})])}],i=(r(4114),r(8443)),o=r(6609),n=r(5720),l={components:{},data(){return{title:"咨询列表",recordList:[],tableParams:{page:1,pageSize:5},total:0,loading:!1}},computed:{userInfo(){return this.$store.state.user.userInfo}},mounted(){this.initData(),this.$bus.$on("refresh-record-list",this.handleQuery)},beforeDestroy(){this.$bus.$off("refresh-record-list",this.handleQuery)},methods:{async initData(){await this.handleQuery()},handleQuery:(0,n.sg)((async function(t={}){if(!this.loading)try{this.loading=!0;const e=await(0,o.Qp)(this.userInfo?.userId);if(!e||!e.patientId)return console.error("未找到患者ID:",e),this.recordList=[],void(this.total=0);console.log("获取到患者ID:",e.patientId),this.tableParams={...this.tableParams,...t,patientId:parseInt(e.patientId)},console.log("查询参数:",this.tableParams);const r=await(0,i.a1)(this.tableParams);console.log("查询结果:",r),r&&(this.recordList=r.recordList||[],this.total=r.total||0)}catch(e){if(e&&"RequestCancelError"===e.name)return;console.error("获取病历列表失败:",e)}finally{this.loading=!1}}),300),goRecordDetail(t){t&&(localStorage.setItem("recordId",t),this.$router.push({path:"/home/recordDetail"}))}}},c=l,d=r(1656),u=(0,d.A)(c,s,a,!1,null,"e1959238",null),p=u.exports},6609:function(t,e,r){r.d(e,{Cr:function(){return i},Qp:function(){return o},Zk:function(){return a}});var s=r(5720);function a(t){return(0,s.Ay)({url:"/patient/update",method:"post",data:t}).catch((t=>((0,s.tq)(t)||console.error("更新患者信息失败:",t),Promise.reject(t))))}function i(t){return(0,s.Ay)({url:"/patient/create",method:"post",data:t}).catch((t=>((0,s.tq)(t)||console.error("创建患者信息失败:",t),Promise.reject(t))))}function o(t){return t?(0,s.Ay)({url:`/patient/get/${t}`,method:"get"}).catch((e=>((0,s.tq)(e)||console.error(`获取患者(ID: ${t})信息失败:`,e),Promise.reject(e)))):Promise.reject("用户ID不能为空")}},8443:function(t,e,r){r.d(e,{$1:function(){return i},EF:function(){return c},a1:function(){return o},se:function(){return n},vL:function(){return l}});var s=r(5720);const a={info:new Map,timestamp:0,EXPIRY:3e5,isExpired(){return Date.now()-this.timestamp>this.EXPIRY},reset(){this.info.clear(),this.timestamp=0}};function i(t){return a.reset(),(0,s.Ay)({url:"/record/add",method:"post",data:t}).catch((t=>((0,s.tq)(t)||console.error("添加病历失败:",t),Promise.reject(t))))}function o(t){return(0,s.Ay)({url:"/record/page",method:"post",data:t}).catch((t=>((0,s.tq)(t)||console.error("获取病历列表失败:",t),Promise.reject(t))))}function n(t){return t?a.info.has(t)&&!a.isExpired()?Promise.resolve(a.info.get(t)):(0,s.Ay)({url:`/record/${t}`,method:"get",retryTimes:2,retryDelay:1e3,timeout:1e4}).then((e=>(e&&(a.info.set(t,e),a.timestamp=Date.now()),e))).catch((e=>((0,s.tq)(e)||(console.error(`获取病历 ${t} 失败:`,e),a.info.delete(t)),Promise.reject(e)))):Promise.reject(new Error("记录ID不能为空"))}function l(t){return t&&t.recordId?a.info.delete(t.recordId):a.reset(),(0,s.Ay)({url:"/record/update",method:"post",data:t}).catch((t=>((0,s.tq)(t)||console.error("更新病历失败:",t),Promise.reject(t))))}function c(t,e=5){return(0,s.Ay)({url:"/record/recommend",method:"post",data:{diagnosisText:t,limit:e}}).catch((t=>((0,s.tq)(t)||console.error("获取诊断推荐失败:",t),Promise.reject(t))))}},4305:function(t,e,r){t.exports=r.p+"static/img/geometric-pattern.13c22a87.svg"}}]);