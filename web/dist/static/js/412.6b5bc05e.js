"use strict";(self["webpackChunkzhenyitong_online_medical"]=self["webpackChunkzhenyitong_online_medical"]||[]).push([[412],{2412:function(t,e,r){r.r(e),r.d(e,{default:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"record-container t-borderStyle"},[e("el-card",{staticStyle:{width:"100%"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("i",{staticClass:"el-icon-back",staticStyle:{cursor:"pointer","margin-right":"5px"},on:{click:t.goBack}}),e("span",[t._v("病历详情")])]),e("div",[e("div",{staticClass:"content"},[e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("患者姓名：")]),t._v(t._s(t.record.patientName))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("患者年龄：")]),t._v(t._s(t.record.age))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("患者联系方式：")]),t._v(t._s(t.record.phone))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("病情自述：")]),t._v(t._s(t.record.description))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("既往史：")]),t._v(t._s(t.record.oldHistory||"-"))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("过敏史：")]),t._v(t._s(t.record.allergiesHistory||"-"))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("生活习惯：")]),t._v(t._s(t.record.habits||"-"))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("所属科室：")]),t._v(t._s(t.record.departmentName))]),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("诊治医生：")]),t._v(t._s(t.record.doctorName))])])])])],1),e("div",{staticClass:"diagnosis-container t-borderStyle"},[e("el-card",{staticStyle:{width:"100%"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("诊断结果")])]),e("el-form",{ref:"diagnosisRef",attrs:{model:t.diagnostic,"label-width":"80px",rules:t.rules}},[e("el-form-item",{attrs:{label:"诊断结果",prop:"result"}},[e("el-input",{attrs:{type:"textarea",disabled:3===t.record.status,placeholder:"输入您的诊断结果"},on:{blur:t.queryRecommendList},model:{value:t.diagnostic.result,callback:function(e){t.$set(t.diagnostic,"result",e)},expression:"diagnostic.result"}})],1),e("el-form-item",{attrs:{label:"治疗方案",prop:"prescription"}},[e("el-input",{attrs:{type:"textarea",disabled:3===t.record.status,placeholder:"输入您的治疗方案"},model:{value:t.diagnostic.prescription,callback:function(e){t.$set(t.diagnostic,"prescription",e)},expression:"diagnostic.prescription"}})],1),e("el-form-item",{attrs:{label:"医嘱",prop:"orders"}},[e("el-input",{attrs:{type:"textarea",disabled:3===t.record.status,placeholder:"输入您的医嘱"},model:{value:t.diagnostic.orders,callback:function(e){t.$set(t.diagnostic,"orders",e)},expression:"diagnostic.orders"}})],1),3!=t.record.status?e("div",{staticStyle:{display:"flex","justify-content":"center",gap:"20px"}},[e("el-button",{attrs:{type:"primary"},on:{click:t.addDiagnosis}},[t._v("提交诊断")]),e("el-button",{attrs:{type:"primary"},on:{click:t.reset}},[t._v("重置诊断")])],1):t._e(),2==t.record.status?e("div",{staticStyle:{"text-align":"center","margin-top":"15px"}},[e("el-alert",{attrs:{title:"诊断已提交，等待患者确认",type:"info",description:"您已完成诊断。患者可在病历详情页查看诊断结果，并可选择结束诊断并提交评分。诊断结束状态(status=3)只能由患者触发。","show-icon":"",closable:!1}})],1):t._e()],1)],1)],1),e("div",{staticClass:"recommend-container t-borderStyle"},[e("el-card",{staticStyle:{width:"100%"}},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("药方推荐列表")]),e("el-tooltip",{attrs:{content:"根据诊断结果自动推荐相似病例的治疗方案",placement:"top"}},[e("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"5px",color:"#909399"}})])],1),t.recommendLoading?e("div",{staticClass:"loading-container"},[e("el-spinner",{attrs:{type:"primary"}}),e("p",[t._v("正在分析诊断结果，查找相似病例...")])],1):0==t.recommendList.length?e("div",[e("el-empty",{attrs:{"image-size":200,description:"暂无相似诊断推荐"}})],1):e("div",t._l(t.recommendList,(function(r){return e("div",{key:r.id,staticClass:"recommend-item"},[e("div",{staticClass:"recommend-header"},[e("span",{staticClass:"doctor-name"},[t._v(t._s(r.docName))]),e("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("相似度: "+t._s((100*r.similarityScore).toFixed(0))+"%")])],1),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("诊断结果：")]),t._v(t._s(r.result))]),e("div",{staticStyle:{"line-height":"30px",display:"flex","align-items":"center"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("患者评分：")]),e("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:r.score,callback:function(e){t.$set(r,"score",e)},expression:"recommend.score"}})],1),e("div",{staticStyle:{"line-height":"30px"}},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v("治疗方案/药方：")]),t._v(t._s(r.prescription))]),e("div",{staticClass:"recommend-actions"},[e("el-button",{attrs:{type:"text",size:"small"},on:{click:function(e){return t.applyRecommendation(r)}}},[e("i",{staticClass:"el-icon-check"}),t._v(" 应用此方案 ")]),e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.recommendDetail(r.recordId)}}},[t._v("查看详情")])],1),e("el-divider")],1)})),0)])],1)])},s=[],o=(r(4114),r(1454),r(8443)),n=r(5720),a={components:{},data(){return{record:{patientName:"",age:"",phone:"",description:"",oldHistory:"",allergiesHistory:"",habits:"",departmentName:"",doctorName:"",status:0,diagnostic:null},recordId:null,diagnostic:{id:"",result:"",prescription:"",orders:""},recommendList:[],recommendLoading:!1,rules:{prescription:[{required:!0,message:"请输入治疗方案",trigger:"blur"}],result:[{required:!0,message:"请输入诊断结果",trigger:"blur"}],orders:[{required:!1,message:"请输入医嘱",trigger:"blur"}]},isComponentUnmounted:!1}},async mounted(){try{if(this.recordId=this.$route.query.recordId,!this.recordId)return void this.$message.error("缺少病历ID参数");(0,n.Ks)();const e=await(0,o.se)(this.recordId);if(this.isComponentUnmounted)return;if(e&&(this.record=e,this.record.diagnostic&&(this.diagnostic={id:this.record.diagnostic.id||"",result:this.record.diagnostic.result||"",prescription:this.record.diagnostic.prescription||"",orders:this.record.diagnostic.orders||""}),0===this.record.status))try{await(0,o.vL)({recordId:this.recordId,status:1}),this.record.status=1,this.$bus.$emit("refresh-diagnosis-list"),console.log("病历状态已更新为已查看")}catch(t){if((0,n.tq)(t))return;console.error("更新病历状态失败:",t)}}catch(t){if(this.isComponentUnmounted||(0,n.tq)(t))return;console.error("获取病历详情失败:",t),this.$message.error("获取病历详情失败，请稍后再试")}},beforeDestroy(){this.isComponentUnmounted=!0,(0,n.Ks)()},methods:{async goBack(){try{this.record&&0===this.record.status&&this.recordId&&(await(0,o.vL)({recordId:this.recordId,status:1}),this.record.status=1),this.$bus.$emit("refresh-diagnosis-list"),this.$router.push("/home/diagnosisList")}catch(t){if((0,n.tq)(t))return;console.error("更新病历状态失败:",t),this.$router.push("/home/diagnosisList")}},addDiagnosis(){this.$refs.diagnosisRef&&this.$refs.diagnosisRef.validate((async t=>{if(t)try{await(0,o.vL)({recordId:this.recordId,status:2,diagnostic:{result:this.diagnostic.result,prescription:this.diagnostic.prescription,orders:this.diagnostic.orders}}),this.$message.success("诊断提交成功"),this.record.status=2,this.$bus.$emit("refresh-diagnosis-list"),setTimeout((()=>{this.$router.push("/home/diagnosisList")}),1e3)}catch(e){if((0,n.tq)(e))return;console.error("提交诊断失败:",e),this.$message.error("提交诊断失败，请稍后再试")}}))},reset(){this.$refs.diagnosisRef&&this.$refs.diagnosisRef.resetFields()},async queryRecommendList(){if(this.diagnostic.result)try{this.$set(this,"recommendLoading",!0);const t=await(0,o.EF)(this.diagnostic.result);if(this.isComponentUnmounted)return;t&&t.recommendations?(this.recommendList=t.recommendations.map((t=>({id:t.diagnosticId,docName:t.docName||"未知医生",result:t.result||"未知诊断",score:t.score||0,prescription:t.prescription||"无处方信息",recordId:t.recordId,similarityScore:t.similarityScore}))),0===this.recommendList.length&&this.$message.info("未找到相似的诊断记录")):(this.recommendList=[],this.$message.warning("获取推荐列表失败"))}catch(t){if(this.isComponentUnmounted||(0,n.tq)(t))return;console.error("获取推荐列表失败:",t),this.$message.error("获取推荐列表失败，请稍后再试"),this.recommendList=[]}finally{this.isComponentUnmounted||this.$set(this,"recommendLoading",!1)}},recommendDetail(t){t&&(t.toString()!==this.recordId.toString()?((0,n.Ks)(),this.$router.push({path:"/diagnosis/detail",query:{recordId:t}}).catch((t=>{"NavigationDuplicated"!==t.name&&(console.error("路由跳转错误:",t),this.$message.error("页面跳转失败，请稍后再试"))}))):this.$message.info("已经在当前病历详情页"))},applyRecommendation(t){t&&this.$confirm(`确定要应用"${t.docName}"医生的诊断方案吗？`,"应用推荐方案",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((()=>{this.diagnostic.result=t.result||this.diagnostic.result,this.diagnostic.prescription=t.prescription||this.diagnostic.prescription,t.orders&&(this.diagnostic.orders=t.orders),this.$message.success("已应用推荐的诊断方案"),this.$notify({title:"提示",message:"您可以根据实际情况修改应用的诊断方案",type:"info",duration:5e3})})).catch((()=>{}))}}},c=a,d=r(1656),l=(0,d.A)(c,i,s,!1,null,"5ea8ad54",null),u=l.exports},8443:function(t,e,r){r.d(e,{$1:function(){return o},EF:function(){return d},a1:function(){return n},se:function(){return a},vL:function(){return c}});var i=r(5720);const s={info:new Map,timestamp:0,EXPIRY:3e5,isExpired(){return Date.now()-this.timestamp>this.EXPIRY},reset(){this.info.clear(),this.timestamp=0}};function o(t){return s.reset(),(0,i.Ay)({url:"/record/add",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("添加病历失败:",t),Promise.reject(t))))}function n(t){return(0,i.Ay)({url:"/record/page",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("获取病历列表失败:",t),Promise.reject(t))))}function a(t){return t?s.info.has(t)&&!s.isExpired()?Promise.resolve(s.info.get(t)):(0,i.Ay)({url:`/record/${t}`,method:"get",retryTimes:2,retryDelay:1e3,timeout:1e4}).then((e=>(e&&(s.info.set(t,e),s.timestamp=Date.now()),e))).catch((e=>((0,i.tq)(e)||(console.error(`获取病历 ${t} 失败:`,e),s.info.delete(t)),Promise.reject(e)))):Promise.reject(new Error("记录ID不能为空"))}function c(t){return t&&t.recordId?s.info.delete(t.recordId):s.reset(),(0,i.Ay)({url:"/record/update",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("更新病历失败:",t),Promise.reject(t))))}function d(t,e=5){return(0,i.Ay)({url:"/record/recommend",method:"post",data:{diagnosisText:t,limit:e}}).catch((t=>((0,i.tq)(t)||console.error("获取诊断推荐失败:",t),Promise.reject(t))))}},6319:function(t,e,r){var i=r(8551),s=r(9539);t.exports=function(t,e,r,o){try{return o?e(i(r)[0],r[1]):e(r)}catch(n){s(t,"throw",n)}}},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},6279:function(t,e,r){var i=r(6840);t.exports=function(t,e,r){for(var s in e)i(t,s,e[s],r);return t}},9462:function(t,e,r){var i=r(9565),s=r(2360),o=r(6699),n=r(6279),a=r(8227),c=r(1181),d=r(5966),l=r(7657).IteratorPrototype,u=r(2529),h=r(9539),p=a("toStringTag"),m="IteratorHelper",g="WrapForValidIterator",f=c.set,v=function(t){var e=c.getterFor(t?g:m);return n(s(l),{next:function(){var r=e(this);if(t)return r.nextHandler();if(r.done)return u(void 0,!0);try{var i=r.nextHandler();return r.returnHandlerResult?i:u(i,r.done)}catch(s){throw r.done=!0,s}},return:function(){var r=e(this),s=r.iterator;if(r.done=!0,t){var o=d(s,"return");return o?i(o,s):u(void 0,!0)}if(r.inner)try{h(r.inner.iterator,"normal")}catch(n){return h(s,"throw",n)}return s&&h(s,"normal"),u(void 0,!0)}})},y=v(!0),_=v(!1);o(_,p,"Iterator Helper"),t.exports=function(t,e,r){var i=function(i,s){s?(s.iterator=i.iterator,s.next=i.next):s=i,s.type=e?g:m,s.returnHandlerResult=!!r,s.nextHandler=t,s.counter=0,s.done=!1,f(this,s)};return i.prototype=e?y:_,i}},713:function(t,e,r){var i=r(9565),s=r(9306),o=r(8551),n=r(1767),a=r(9462),c=r(6319),d=a((function(){var t=this.iterator,e=o(i(this.next,t)),r=this.done=!!e.done;if(!r)return c(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function(t){return o(this),s(t),new d(n(this),{mapper:t})}},1701:function(t,e,r){var i=r(6518),s=r(713),o=r(6395);i({target:"Iterator",proto:!0,real:!0,forced:o},{map:s})},1454:function(t,e,r){r(1701)}}]);