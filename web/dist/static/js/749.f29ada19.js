"use strict";(self["webpackChunkzhenyitong_online_medical"]=self["webpackChunkzhenyitong_online_medical"]||[]).push([[749],{8749:function(e,r,t){t.r(r),t.d(r,{default:function(){return P}});var s=function(){var e=this,r=e._self._c;return r("div",{staticClass:"main-container"},[r("div",{staticClass:"overlay"}),r("div",{staticClass:"login-container"},[r("div",{staticClass:"login-warp-main"},[r("div",{staticClass:"login-warp-main-title"},[e._v(" 诊易通-在线问诊平台 ")]),r("div",{staticClass:"login-warp-main-form"},[e.isLogin?r("login",{on:{switchToRegister:function(r){e.isLogin=!1,e.isForget=!1},switchToForget:function(r){e.isLogin=!1,e.isForget=!0}}}):e._e(),e.isLogin||e.isForget?e._e():r("register",{on:{switchToLogin:function(r){e.isLogin=!0}}}),e.isForget?r("forget",{on:{switchToLogin:function(r){e.isLogin=!0,e.isForget=!1}}}):e._e()],1)])])])},l=[],o=function(){var e=this,r=e._self._c;return r("div",{staticClass:"login-form-container"},[r("el-form",{ref:"ruleFormRef",attrs:{model:e.ruleForm,rules:e.rules}},[r("el-form-item",{attrs:{prop:"identity"}},[r("el-input",{attrs:{text:"",placeholder:"请输入用户名/手机号/邮箱",clearable:"",autocomplete:"off"},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.login.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[r("i",{staticClass:"el-icon-user"})]},proxy:!0}]),model:{value:e.ruleForm.identity,callback:function(r){e.$set(e.ruleForm,"identity",r)},expression:"ruleForm.identity"}})],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入密码","show-password":"",autocomplete:"off"},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.login.apply(null,arguments)}},scopedSlots:e._u([{key:"prefix",fn:function(){return[r("i",{staticClass:"el-icon-lock"})]},proxy:!0}]),model:{value:e.ruleForm.password,callback:function(r){e.$set(e.ruleForm,"password",r)},expression:"ruleForm.password"}})],1),r("el-form-item",[r("el-button",{staticClass:"submit-btn",attrs:{type:"primary",round:"",loading:e.loading},on:{click:e.login}},[e._v("登 录")])],1)],1),r("div",{staticClass:"extra-warp"},[r("div",{staticClass:"t-cursor link-text",on:{click:function(r){return e.$emit("switchToForget")}}},[e._v("忘记密码?")]),r("div",{staticClass:"t-cursor link-text",on:{click:function(r){return e.$emit("switchToRegister")}}},[e._v("立即注册")])])],1)},a=[],i=(t(4114),t(2549)),n=t(6017),u={components:{},data(){return{ruleFormRef:null,ruleForm:{identity:"",password:""},rules:{identity:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1}},mounted(){},methods:{login(){this.$refs.ruleFormRef.validate((e=>{if(!e)return!1;try{this.loading=!0;const e=(0,n.Q)(this.ruleForm.password);(0,i.iD)({...this.ruleForm,password:e}).then((e=>{if(e){const r={...e,password:(0,n.Q)(e.password)};this.$store.dispatch("setUserInfo",r),0===this.$store.state.user.userInfo.role?this.$router.push({path:"/home"}):this.$router.push({path:"/home/diagnosisList"})}})).catch((e=>{console.error("登录失败:",e),this.$message.error("登录失败，请检查用户名和密码")})).finally((()=>{this.loading=!1}))}catch(r){console.error("登录过程中发生错误:",r),this.$message.error("登录过程中发生错误"),this.loading=!1}}))}}},m=u,c=t(1656),p=(0,c.A)(m,o,a,!1,null,"62de6454",null),d=p.exports,g=function(){var e=this,r=e._self._c;return r("div",{staticClass:"register-container"},[r("el-form",{ref:"ruleFormRef",staticClass:"register-form",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"角色",prop:"role"}},[r("el-radio-group",{on:{change:e.handleRoleChange},model:{value:e.ruleForm.role,callback:function(r){e.$set(e.ruleForm,"role",r)},expression:"ruleForm.role"}},[r("el-radio",{attrs:{label:0}},[e._v("患者")]),r("el-radio",{attrs:{label:1}},[e._v("医师")])],1)],1),r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{attrs:{placeholder:"请输入用户名",clearable:"",autocomplete:"off"},model:{value:e.ruleForm.username,callback:function(r){e.$set(e.ruleForm,"username",r)},expression:"ruleForm.username"}})],1),r("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[r("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.ruleForm.phone,callback:function(r){e.$set(e.ruleForm,"phone",r)},expression:"ruleForm.phone"}})],1),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.ruleForm.email,callback:function(r){e.$set(e.ruleForm,"email",r)},expression:"ruleForm.email"}})],1),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password",placeholder:"请输入密码",autocomplete:"off"},model:{value:e.ruleForm.password,callback:function(r){e.$set(e.ruleForm,"password",r)},expression:"ruleForm.password"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[r("el-input",{attrs:{type:"password",placeholder:"请确认密码",autocomplete:"off"},model:{value:e.ruleForm.checkPass,callback:function(r){e.$set(e.ruleForm,"checkPass",r)},expression:"ruleForm.checkPass"}})],1),1===e.ruleForm.role?[r("el-divider",{attrs:{"content-position":"center"}},[e._v("医师信息")]),r("el-form-item",{attrs:{label:"所在城市",prop:"cityName"}},[r("el-input",{attrs:{placeholder:"请输入所在城市"},model:{value:e.ruleForm.cityName,callback:function(r){e.$set(e.ruleForm,"cityName",r)},expression:"ruleForm.cityName"}})],1),r("el-form-item",{attrs:{label:"所在科室",prop:"departmentName"}},[r("el-select",{attrs:{placeholder:"请选择科室"},model:{value:e.ruleForm.departmentName,callback:function(r){e.$set(e.ruleForm,"departmentName",r)},expression:"ruleForm.departmentName"}},e._l(e.departmentOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"所属医院",prop:"hospitalName"}},[r("el-input",{attrs:{placeholder:"请输入所属医院"},model:{value:e.ruleForm.hospitalName,callback:function(r){e.$set(e.ruleForm,"hospitalName",r)},expression:"ruleForm.hospitalName"}})],1),r("el-form-item",{attrs:{label:"专业背景",prop:"introduction"}},[r("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请简要介绍您的专业背景、擅长领域等"},model:{value:e.ruleForm.introduction,callback:function(r){e.$set(e.ruleForm,"introduction",r)},expression:"ruleForm.introduction"}})],1)]:e._e(),r("div",{staticClass:"extra-warp"},[r("el-button",{staticClass:"submit-btn",on:{click:e.cancel}},[e._v("取消")]),r("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:e.loading},on:{click:e.register}},[e._v("注册")])],1)],2)],1)},h=[],f=t(7909),F={components:{},data(){var e=(e,r,t)=>{""===r?t(new Error("请再次输入密码")):r!==this.ruleForm.password?t(new Error("两次输入密码不一致!")):t()};return{ruleFormRef:null,ruleForm:{role:0,username:"",password:"",checkPass:"",phone:"",email:"",cityName:"",hospitalName:"",departmentName:"",introduction:""},rules:{role:[{required:!0,message:"请选择用户角色",trigger:"change"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码不少于6个字符",trigger:"blur"}],checkPass:[{validator:e,required:!0,trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的电话号码！",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],cityName:[{required:!0,message:"请输入所在城市",trigger:"blur"}],hospitalName:[{required:!0,message:"请输入所属医院",trigger:"blur"}],departmentName:[{required:!0,message:"请选择所在科室",trigger:"change"}],introduction:[{required:!0,message:"请输入专业背景",trigger:"blur"}]},departmentOptions:[{value:"心血管内科",label:"心血管内科"},{value:"神经外科",label:"神经外科"},{value:"呼吸科",label:"呼吸科"},{value:"骨科",label:"骨科"},{value:"儿科",label:"儿科"},{value:"消化内科",label:"消化内科"},{value:"眼科",label:"眼科"},{value:"皮肤科",label:"皮肤科"},{value:"妇产科",label:"妇产科"},{value:"中西医结合科",label:"中西医结合科"},{value:"针灸科",label:"针灸科"},{value:"推拿科",label:"推拿科"}],loading:!1}},mounted(){},methods:{handleRoleChange(e){this.$nextTick((()=>{this.$refs.ruleFormRef.clearValidate()}))},cancel(){this.$refs.ruleFormRef.resetFields(),this.$emit("switchToLogin")},register(){this.$refs.ruleFormRef.validate((async e=>{if(e)try{this.loading=!0;const e=(0,n.Q)(this.ruleForm.password),t={username:this.ruleForm.username,password:e,phone:this.ruleForm.phone,email:this.ruleForm.email,role:this.ruleForm.role};console.log("开始注册用户基本信息...");const s=await(0,i.kz)(t);if(console.log("用户注册API响应:",s),s&&s.userId){if(console.log(`用户注册成功，获取到userId: ${s.userId}`),1===this.ruleForm.role)try{console.log("开始创建医生专业信息...");const e={userId:s.userId,doctorName:this.ruleForm.username,cityName:this.ruleForm.cityName,hospitalName:this.ruleForm.hospitalName,departmentName:this.ruleForm.departmentName,introduction:this.ruleForm.introduction};console.log("正在提交医生信息:",JSON.stringify(e));const r=await(0,f.QQ)(e);console.log("医生信息创建成功",r),this.$message.success("医师注册成功")}catch(r){console.error("医师信息创建失败:",r),this.$message.error("医师信息创建失败，请联系管理员。您可以稍后使用相同的用户名重新注册")}else this.$message.success("患者注册成功");this.$emit("switchToLogin")}else console.error("用户注册异常：未返回用户ID",JSON.stringify(s)),this.$message.error("注册异常，请检查用户名是否已存在")}catch(r){console.error("注册失败:",r);let e="注册失败";r.response&&r.response.data&&r.response.data.message?e+=`: ${r.response.data.message}`:r.message?e+=`: ${r.message}`:e+="，请稍后再试",this.$message.error(e)}finally{this.loading=!1}}))}}},b=F,v=(0,c.A)(b,g,h,!1,null,"59a17300",null),y=v.exports,w=function(){var e=this,r=e._self._c;return r("div",[r("el-steps",{attrs:{active:e.active,"finish-status":"success","align-center":""}},[r("el-step",{attrs:{title:"身份验证"}}),r("el-step",{attrs:{title:"密码重置"}}),r("el-step",{attrs:{title:"重置完成"}})],1),0===e.active?r("div",{staticClass:"main-container"},[r("el-form",{ref:"ruleFormRef",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"账号名",prop:"identity"}},[r("el-input",{attrs:{placeholder:"请输入用户名/手机号/邮箱",clearable:"",autocomplete:"off"},model:{value:e.ruleForm.identity,callback:function(r){e.$set(e.ruleForm,"identity",r)},expression:"ruleForm.identity"}})],1)],1),r("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:e.loading},on:{click:e.next}},[e._v("下一步")])],1):e._e(),1===e.active?r("div",{staticClass:"main-container"},[r("el-form",{ref:"ruleFormRef",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{type:"password","show-password":"",placeholder:"请输入密码",autocomplete:"off"},model:{value:e.ruleForm.password,callback:function(r){e.$set(e.ruleForm,"password",r)},expression:"ruleForm.password"}})],1),r("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[r("el-input",{attrs:{type:"password",placeholder:"请确认密码",autocomplete:"off"},model:{value:e.ruleForm.checkPass,callback:function(r){e.$set(e.ruleForm,"checkPass",r)},expression:"ruleForm.checkPass"}})],1)],1),r("el-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:e.loading},on:{click:e.next}},[e._v("下一步")])],1):e._e(),2===e.active?r("div",{staticClass:"main-container"},[r("div",{staticStyle:{height:"115px","text-align":"center",padding:"30px 0"}},[e._v(" (*^_^*)密码已重置成功，请重新登录！ ")]),r("el-button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:function(r){return e.$emit("switchToLogin")}}},[e._v("重新登录")])],1):e._e()],1)},k=[],$={components:{},data(){var e=(e,r,t)=>{""===r?t(new Error("请再次输入密码")):r!==this.ruleForm.password?t(new Error("两次输入密码不一致!")):t()};return{active:0,ruleFormRef:null,ruleForm:{identity:"",password:"",checkPass:""},rules:{identity:[{required:!0,message:"请输入用户名/手机号/邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码不少于6个字符",trigger:"blur"}],checkPass:[{validator:e,required:!0,trigger:"blur"}]},loading:!1}},mounted(){},methods:{next(){this.$refs.ruleFormRef.validate((async e=>{if(e){this.loading=!0;try{if(0===this.active){const e=await(0,i.PA)(this.ruleForm.identity);e&&this.active++}else if(1===this.active){const e=(0,n.Q)(this.ruleForm.password),r=await(0,i.updatePassword)({...this.ruleForm,password:e});r&&this.active++}}catch(r){console.error("操作失败：",r),this.$message.error("操作失败，请稍后再试")}finally{this.loading=!1}}})),this.active>2&&(this.active=0)}}},x=$,_=(0,c.A)(x,w,k,!1,null,"43ab51b0",null),C=_.exports,N={components:{login:d,register:y,forget:C},data(){return{isLogin:!0,isForget:!1}},mounted(){},methods:{}},R=N,q=(0,c.A)(R,s,l,!1,null,"5428f6d7",null),P=q.exports}}]);