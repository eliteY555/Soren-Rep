"use strict";(self["webpackChunkzhenyitong_online_medical"]=self["webpackChunkzhenyitong_online_medical"]||[]).push([[212],{1212:function(e,t,o){o.r(t),o.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%",height:"100%"}},[t("el-container",{staticStyle:{height:"100%","flex-direction":"column"}},[t("el-header",{staticClass:"app-header"},[t("div",{staticClass:"header-content"},[t("div",{staticClass:"left-section"},[t("div",{staticClass:"logo"},[t("i",{staticClass:"el-icon-s-help"}),t("h2",[e._v("诊易通-在线问诊平台")])]),t("el-menu",{staticClass:"horizontal-menu",attrs:{"default-active":e.defaultActive,mode:"horizontal",router:"","background-color":"transparent","text-color":"#ffffff","active-text-color":"#ffffff"}},e._l(e.allowedRoutes,(function(o){return t("el-menu-item",{key:o.path,staticClass:"horizontal-menu-item",attrs:{index:o.path}},[t("i",{class:o.icon}),t("span",[e._v(e._s(o.name))])])})),1)],1),t("el-dropdown",{staticClass:"user-dropdown",attrs:{trigger:"hover"}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-user"}),t("span",{staticClass:"username"},[e._v(e._s(e.userInfo&&e.userInfo.username||"未登录"))])]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{icon:"el-icon-user-solid"}},[e._v(e._s(e.userInfo&&e.userInfo.username||"未登录"))]),t("hr"),t("el-dropdown-item",{attrs:{icon:"el-icon-edit"},nativeOn:{click:function(t){e.userInfoVisible=!0}}},[e._v("基础信息")]),t("el-dropdown-item",{attrs:{icon:"el-icon-message"},nativeOn:{click:function(t){e.updateInfoVisible=!0}}},[e._v("详细信息")]),t("el-dropdown-item",{attrs:{icon:"el-icon-switch-button"},nativeOn:{click:function(t){return e.logout.apply(null,arguments)}}},[e._v("退出系统")])],1)],1)],1)]),t("el-main",{staticClass:"app-main"},[t("div",{staticClass:"decorative-elements"},[t("div",{staticClass:"cloud-pattern top-left"}),t("div",{staticClass:"cloud-pattern bottom-right"}),t("div",{staticClass:"floral-pattern top-right"}),t("div",{staticClass:"floral-pattern bottom-left"})]),t("keep-alive",[t("router-view")],1)],1)],1),t("el-dialog",{attrs:{title:"修改基础信息",width:"65%",visible:e.userInfoVisible},on:{"update:visible":function(t){e.userInfoVisible=t}}},[e.userInfo?t("el-form",{ref:"userInfoRef",attrs:{model:e.userInfo,rules:e.userInfoRule,"label-width":"80px"}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.userInfo.phone,callback:function(t){e.$set(e.userInfo,"phone",t)},expression:"userInfo.phone"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"角色",prop:"role"}},[t("el-radio-group",{attrs:{disabled:""},model:{value:e.userInfo.role,callback:function(t){e.$set(e.userInfo,"role",t)},expression:"userInfo.role"}},[t("el-radio",{attrs:{label:0}},[e._v("患者")]),t("el-radio",{attrs:{label:1}},[e._v("医师")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1)],1)],1),t("div",{staticClass:"password-section"},[t("div",{staticClass:"password-section-header"},[t("h4",[e._v("修改密码（可选）")]),t("span",{staticClass:"password-tip"},[e._v("如需修改密码，请同时填写原密码和新密码")])]),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"原密码"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入原密码",autocomplete:"off"},model:{value:e.userInfo.oldPassword,callback:function(t){e.$set(e.userInfo,"oldPassword",t)},expression:"userInfo.oldPassword"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"新密码"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入新密码",autocomplete:"off"},model:{value:e.userInfo.newPassword,callback:function(t){e.$set(e.userInfo,"newPassword",t)},expression:"userInfo.newPassword"}})],1)],1)],1)],1)],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.reset("userInfoRef")}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.updateBasicInfo}},[e._v("确 定")])],1)],1),e.userInfo&&0===e.userInfo.role?t("el-dialog",{attrs:{title:"修改患者信息",width:"65%",visible:e.updateInfoVisible},on:{"update:visible":function(t){e.updateInfoVisible=t}}},[t("el-form",{ref:"infoFormRef",attrs:{model:e.infoForm,rules:e.infoRule,"label-width":"80px"}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"patientName"}},[t("el-input",{attrs:{placeholder:"请输入姓名",clearable:""},model:{value:e.infoForm.patientName,callback:function(t){e.$set(e.infoForm,"patientName",t)},expression:"infoForm.patientName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"年龄",prop:"age"}},[t("el-input",{attrs:{placeholder:"请输入年龄",clearable:""},model:{value:e.infoForm.age,callback:function(t){e.$set(e.infoForm,"age",t)},expression:"infoForm.age"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"性别",prop:"sex"}},[t("el-radio-group",{model:{value:e.infoForm.sex,callback:function(t){e.$set(e.infoForm,"sex",t)},expression:"infoForm.sex"}},[t("el-radio",{attrs:{label:0}},[e._v("男")]),t("el-radio",{attrs:{label:1}},[e._v("女")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"既往史"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入既往史（既往是否有类似症状、是否患有慢性疾病，如高血压、糖尿病等）"},model:{value:e.infoForm.oldHistory,callback:function(t){e.$set(e.infoForm,"oldHistory",t)},expression:"infoForm.oldHistory"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"过敏史"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入过敏史（对药物、食物或环境因素的过敏情况）"},model:{value:e.infoForm.allergiesHistory,callback:function(t){e.$set(e.infoForm,"allergiesHistory",t)},expression:"infoForm.allergiesHistory"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"生活习惯"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入过敏史（可以包括饮食、睡眠、情绪、烟酒史等）"},model:{value:e.infoForm.habits,callback:function(t){e.$set(e.infoForm,"habits",t)},expression:"infoForm.habits"}})],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.reset("infoFormRef")}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.updatePatientInfo}},[e._v("确 定")])],1)],1):e._e(),e.userInfo&&1===e.userInfo.role?t("el-dialog",{attrs:{title:"修改医生信息",width:"65%",visible:e.updateInfoVisible},on:{"update:visible":function(t){e.updateInfoVisible=t}}},[t("el-form",{ref:"infoFormRef",attrs:{model:e.infoForm,rules:e.infoRule,"label-width":"80px"}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"doctorName"}},[t("el-input",{attrs:{placeholder:"请输入姓名",clearable:""},model:{value:e.infoForm.doctorName,callback:function(t){e.$set(e.infoForm,"doctorName",t)},expression:"infoForm.doctorName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"所在地区"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择地区"},model:{value:e.infoForm.cityName,callback:function(t){e.$set(e.infoForm,"cityName",t)},expression:"infoForm.cityName"}},e._l(e.cities,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"所在医院"}},[t("el-input",{attrs:{placeholder:"请输入所在医院",clearable:""},model:{value:e.infoForm.hospitalName,callback:function(t){e.$set(e.infoForm,"hospitalName",t)},expression:"infoForm.hospitalName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"所在科室"}},[t("el-input",{attrs:{placeholder:"请输入所在科室",clearable:""},model:{value:e.infoForm.departmentName,callback:function(t){e.$set(e.infoForm,"departmentName",t)},expression:"infoForm.departmentName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"个人简介"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入个人简介"},model:{value:e.infoForm.introduction,callback:function(t){e.$set(e.infoForm,"introduction",t)},expression:"infoForm.introduction"}})],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.reset("infoFormRef")}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.updateDoctorInfo}},[e._v("确 定")])],1)],1):e._e()],1)},r=[],a=(o(4114),o(8992),o(4520),o(2577),o(2549)),l=o(6017),i=[{label:"北京",value:"北京"},{label:"天津",value:"天津"},{label:"河北",value:"河北"},{label:"山西",value:"山西"},{label:"内蒙古",value:"内蒙古"},{label:"辽宁",value:"辽宁"},{label:"吉林",value:"吉林"},{label:"黑龙江",value:"黑龙江"},{label:"上海",value:"上海"},{label:"江苏",value:"江苏"},{label:"浙江",value:"浙江"},{label:"安徽",value:"安徽"},{label:"福建",value:"福建"},{label:"江西",value:"江西"},{label:"山东",value:"山东"},{label:"河南",value:"河南"},{label:"湖北",value:"湖北"},{label:"湖南",value:"湖南"},{label:"广东",value:"广东"},{label:"广西",value:"广西"},{label:"海南",value:"海南"},{label:"重庆",value:"重庆"},{label:"四川",value:"四川"},{label:"贵州",value:"贵州"},{label:"云南",value:"云南"},{label:"西藏",value:"西藏"},{label:"陕西",value:"陕西"},{label:"甘肃",value:"甘肃"},{label:"青海",value:"青海"},{label:"宁夏",value:"宁夏"},{label:"新疆",value:"新疆"},{label:"香港",value:"香港"},{label:"澳门",value:"澳门"},{label:"台湾",value:"台湾"}],n=o(6609),u=o(7909),c=o(5720),f={components:{},data(){return{defaultActive:this.$route.path,userInfoVisible:!1,updateInfoVisible:!1,sidebarBgColor:"#f3ece2",sidebarTextColor:"#60503c",sidebarActiveTextColor:"#8b6f4e",userInfoRule:{phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的电话号码！",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},infoForm:{patientName:"",age:"",sex:0,oldHistory:"",allergiesHistory:"",habits:"",doctorName:"",cityName:"",hospitalName:"",departmentName:"",introduction:""},infoRule:{patientName:[{required:!0,message:"请输入姓名",trigger:"blur"}],doctorName:[{required:!0,message:"请输入姓名",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}],age:[{required:!0,message:"请输入年龄",trigger:"blur"}]},cities:[]}},computed:{userInfo(){return this.$store.state.user.userInfo},allowedRoutes(){return this.userInfo?this.$router.options.routes.find((e=>"/home"===e.path)).children.filter((e=>e?.meta?.roles.includes(this.userInfo.role))):[]}},watch:{async updateInfoVisible(e){if(e&&this.userInfo)try{if(0===this.userInfo.role){const e=await(0,n.Qp)(this.userInfo.userId);e&&(this.infoForm={...this.infoForm,...e})}else{const e=await(0,u.Q9)(this.userInfo.userId);e&&(this.infoForm={...this.infoForm,...e})}}catch(t){console.error("获取用户信息失败:",t),this.$message.error("获取用户信息失败，请稍后再试")}},userInfoVisible(e){e&&this.userInfo&&(this.userInfo.oldPassword="",this.userInfo.newPassword="",this.$nextTick((()=>{this.$refs.userInfoRef&&this.$refs.userInfoRef.clearValidate()})))}},async mounted(){this.cities=i,this.userInfo&&(this.userInfo.oldPassword="",this.userInfo.newPassword="")},methods:{reset(e){try{this.$refs[e]&&this.$refs[e].resetFields()}catch(t){console.error("重置表单失败:",t)}finally{this.userInfoVisible=!1,this.updateInfoVisible=!1}},async updateBasicInfo(){this.$refs.userInfoRef.validate((async e=>{if(!e)return this.$message.error("请填写必填项"),!1;try{const e={...this.userInfo};if(this.userInfo.oldPassword&&this.userInfo.newPassword)e.oldPassword=(0,l.Q)(this.userInfo.oldPassword),e.newPassword=(0,l.Q)(this.userInfo.newPassword);else if(this.userInfo.oldPassword&&!this.userInfo.newPassword||!this.userInfo.oldPassword&&this.userInfo.newPassword)return void this.$message.warning("修改密码需同时填写原密码和新密码");const t=await(0,a.yo)(e);if(t){this.$message.success("修改成功"),this.userInfoVisible=!1;const e={...this.userInfo};delete e.oldPassword,delete e.newPassword,this.$store.dispatch("setUserInfo",e)}}catch(t){console.error("更新用户信息失败:",t),this.$message.error("修改失败，请稍后再试")}}))},updatePatientInfo(){this.$refs.infoFormRef.validate((async e=>{if(e)try{this.infoForm.userId=this.userInfo.userId;let e,o=!0;try{const e=await(0,n.Qp)(this.userInfo.userId);o=e&&e.patientId}catch(t){o=!1,console.log("患者信息不存在，将创建新记录")}if(e=o?await(0,n.Zk)(this.infoForm):await(0,n.Cr)(this.infoForm),e){this.$message.success("修改成功"),this.updateInfoVisible=!1;try{const e=await(0,n.Qp)(this.userInfo.userId);if(e){const t={...this.userInfo,sex:e.sex};this.$store.dispatch("setUserInfo",t),this.$bus.$emit("user-info-updated",e)}}catch(t){console.error("获取更新后的患者信息失败:",t),this.$message.error("获取更新后的患者信息失败，请刷新页面")}}}catch(t){console.error("更新患者信息失败:",t),this.$message.error("保存失败，请稍后再试")}}))},updateDoctorInfo(){this.$refs.infoFormRef.validate((async e=>{if(e)try{const e=await(0,u.BL)(this.infoForm);e&&(this.$message.success("修改成功"),this.updateInfoVisible=!1)}catch(t){console.log(t)}}))},logout(){this.$confirm("确定退出登录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$store.dispatch("clearUserInfo"),this.$router.push({path:"/"}),this.$message({type:"success",message:"退出登录成功!"})})).catch((()=>{}))}},beforeDestroy(){(0,c.Ks)()}},d=f,m=o(1656),p=(0,m.A)(d,s,r,!1,null,"16a77958",null),h=p.exports},6609:function(e,t,o){o.d(t,{Cr:function(){return a},Qp:function(){return l},Zk:function(){return r}});var s=o(5720);function r(e){return(0,s.Ay)({url:"/patient/update",method:"post",data:e}).catch((e=>((0,s.tq)(e)||console.error("更新患者信息失败:",e),Promise.reject(e))))}function a(e){return(0,s.Ay)({url:"/patient/create",method:"post",data:e}).catch((e=>((0,s.tq)(e)||console.error("创建患者信息失败:",e),Promise.reject(e))))}function l(e){return e?(0,s.Ay)({url:`/patient/get/${e}`,method:"get"}).catch((t=>((0,s.tq)(t)||console.error(`获取患者(ID: ${e})信息失败:`,t),Promise.reject(t)))):Promise.reject("用户ID不能为空")}},2489:function(e,t,o){var s=o(6518),r=o(9565),a=o(9306),l=o(8551),i=o(1767),n=o(9462),u=o(6319),c=o(6395),f=n((function(){var e,t,o,s=this.iterator,a=this.predicate,i=this.next;while(1){if(e=l(r(i,s)),t=this.done=!!e.done,t)return;if(o=e.value,u(s,a,[o,this.counter++],!0))return o}}));s({target:"Iterator",proto:!0,real:!0,forced:c},{filter:function(e){return l(this),a(e),new f(i(this),{predicate:e})}})},116:function(e,t,o){var s=o(6518),r=o(2652),a=o(9306),l=o(8551),i=o(1767);s({target:"Iterator",proto:!0,real:!0},{find:function(e){l(this),a(e);var t=i(this),o=0;return r(t,(function(t,s){if(e(t,o++))return s(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},4520:function(e,t,o){o(2489)},2577:function(e,t,o){o(116)}}]);