"use strict";(self["webpackChunkzhenyitong_online_medical"]=self["webpackChunkzhenyitong_online_medical"]||[]).push([[202],{1202:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"record-detail-container"},[e("el-card",{staticClass:"record-card",attrs:{shadow:"hover"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"header-left"},[e("i",{staticClass:"el-icon-back",staticStyle:{cursor:"pointer","margin-right":"10px"},on:{click:t.goBack}}),e("span",{staticClass:"header-title"},[t._v("病历详情")])]),e("div",{staticClass:"header-status"},[0==t.record.status?e("el-tag",{attrs:{size:"small",type:"info"}},[t._v("待诊断")]):1==t.record.status?e("el-tag",{attrs:{size:"small",type:"warning"}},[t._v("已查看")]):2==t.record.status?e("el-tag",{attrs:{size:"small",type:"success"}},[t._v("已诊断")]):3==t.record.status?e("el-tag",{attrs:{size:"small",type:"primary"}},[t._v("诊断已结束")]):t._e()],1)]),e("div",{staticClass:"record-content"},[e("div",{staticClass:"info-section"},[e("div",{staticClass:"section-title"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v("患者基本信息")])]),e("div",{staticClass:"info-grid"},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"label"},[t._v("患者姓名：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.patientName))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"label"},[t._v("患者年龄：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.age))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"label"},[t._v("联系方式：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.phone))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"label"},[t._v("所属科室：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.departmentName))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"label"},[t._v("诊治医生：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.doctorName))])])]),e("div",{staticClass:"section-title mt-20"},[e("i",{staticClass:"el-icon-document-checked"}),e("span",[t._v("病情描述")])]),e("div",{staticClass:"description-box"},[e("div",{staticClass:"info-item full-width"},[e("span",{staticClass:"label"},[t._v("主诉：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.description))])]),e("div",{staticClass:"info-item full-width"},[e("span",{staticClass:"label"},[t._v("既往史：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.oldHistory||"无"))])]),e("div",{staticClass:"info-item full-width"},[e("span",{staticClass:"label"},[t._v("过敏史：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.allergiesHistory||"无"))])]),e("div",{staticClass:"info-item full-width"},[e("span",{staticClass:"label"},[t._v("生活习惯：")]),e("span",{staticClass:"value"},[t._v(t._s(t.record.habits||"无"))])])])]),e("div",{staticClass:"divider"},[e("div",{staticClass:"divider-line"})]),e("div",{staticClass:"diagnosis-section"},[e("div",{staticClass:"section-title"},[e("i",{staticClass:"el-icon-first-aid-kit"}),e("span",[t._v("诊断信息")])]),null!=t.record.diagnostic?e("div",{staticClass:"diagnosis-content"},[e("div",{staticClass:"diagnosis-box"},[e("div",{staticClass:"diagnosis-header"},[t._v("诊断结果")]),e("div",{staticClass:"diagnosis-body"},[t._v(t._s(t.record.diagnostic.result))])]),e("div",{staticClass:"diagnosis-box"},[e("div",{staticClass:"diagnosis-header"},[t._v("药方")]),e("div",{staticClass:"diagnosis-body"},[t._v(t._s(t.record.diagnostic.prescription))])]),e("div",{staticClass:"diagnosis-box"},[e("div",{staticClass:"diagnosis-header"},[t._v("医嘱")]),e("div",{staticClass:"diagnosis-body"},[t._v(t._s(t.record.diagnostic.orders))])])]):e("div",{staticClass:"no-diagnosis"},[e("el-empty",{attrs:{description:"医生还没诊断,请耐心等待"}},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.notice}},[e("i",{staticClass:"el-icon-bell"}),t._v(" 通知医生 ")])],1)],1)])]),e("div",{staticClass:"action-footer"},[3!=t.record.status?e("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:t.endDialog}},[t._v("结束诊断")]):t._e(),e("el-button",{attrs:{icon:"el-icon-chat-line-round"},on:{click:t.comment}},[t._v("对此诊断有疑问？")])],1)]),e("el-drawer",{attrs:{title:"评论详情",visible:t.drawer},on:{"update:visible":function(e){t.drawer=e}}},[e("h3",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t._v("提出你的疑问吧")]),e("el-form",{attrs:{model:t.commentForm}},[e("el-form-item",[e("el-input",{staticStyle:{width:"95%","margin-left":"10px"},attrs:{type:"textarea",placeholder:"发表交流",autocomplete:"off"},model:{value:t.commentForm.content,callback:function(e){t.$set(t.commentForm,"content",e)},expression:"commentForm.content"}}),e("el-button",{staticStyle:{float:"right","margin-top":"15px","margin-right":"10px"},attrs:{type:"primary",round:""},on:{click:t.submitComment}},[t._v("评论")])],1)],1),e("el-divider"),t.commentsList.length>0?e("div",t._l(t.commentsList,(function(s){return e("div",{key:s.commentId},[e("div",{staticClass:"comment-item"},[e("div",[e("i",{staticClass:"el-icon-user"}),e("span",{staticStyle:{color:"#9f9f9f","margin-left":"2px"}},[t._v(t._s(1==s.role?s.username+"医生":s.username))])]),e("div",{staticStyle:{"margin-left":"16px","margin-bottom":"5px"}},[t._v(t._s(s.content))]),e("div",{staticStyle:{"margin-left":"16px",display:"flex",gap:"10px","align-items":"baseline",color:"#9f9f9f"}},[e("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(s.createTime.split("T")[0]))]),e("div",{staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.showReply(s)}}},[t._v("回复")]),s.userId==t.userInfo.userId?e("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.deleteCommentById(s)}}}):t._e()]),s.replies?e("div",{staticStyle:{"margin-left":"16px"}},[!s.showAllReplies&&s.replies.length>1?e("div",[t._l(s.replies.slice(0,1),(function(i){return e("div",{key:i.replyId},[e("div",[e("i",{staticClass:"el-icon-user"}),e("span",{staticStyle:{color:"#9f9f9f","margin-left":"2px"}},[t._v(t._s(i.username)+" 回复 "+t._s(i.replyedName))])]),e("div",{staticStyle:{"margin-left":"16px","margin-bottom":"5px"}},[t._v(t._s(i.content))]),e("div",{staticStyle:{"margin-left":"16px",display:"flex",gap:"10px","align-items":"baseline",color:"#9f9f9f"}},[e("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(i.createTime.split("T")[0]))]),e("div",{staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.showReply(s)}}},[t._v("回复")]),i.userId==t.userInfo.userId?e("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.deleteCommentById(i)}}}):t._e()])])})),e("div",{staticStyle:{"margin-left":"16px","font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.toggleReplies(s)}}},[t._v(" 点击查看全部回复 ")])],2):e("div",t._l(s.replies,(function(i){return e("div",{key:i.replyId},[e("div",[e("i",{staticClass:"el-icon-user"}),e("span",{staticStyle:{color:"#9f9f9f","margin-left":"2px"}},[t._v(t._s(i.username)+" 回复 "+t._s(i.replyedName))])]),e("div",{staticStyle:{"margin-left":"16px","margin-bottom":"5px"}},[t._v(t._s(i.content))]),e("div",{staticStyle:{"margin-left":"16px",display:"flex",gap:"10px","align-items":"baseline",color:"#9f9f9f"}},[e("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(i.createTime.split("T")[0]))]),e("div",{staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.showReply(s)}}},[t._v("回复")]),i.userId==t.userInfo.userId?e("i",{staticClass:"el-icon-delete",staticStyle:{"font-size":"12px",cursor:"pointer"},on:{click:function(e){return t.deleteCommentById(i)}}}):t._e()])])})),0)]):t._e()]),e("el-divider")],1)})),0):t._e(),0==t.commentsList.length?e("div",[e("el-empty",{attrs:{description:"暂无评论"}})],1):t._e()],1),e("el-dialog",{attrs:{title:"结束诊断",visible:t.endDialogVisible,width:"30%","custom-class":"end-dialog"},on:{"update:visible":function(e){t.endDialogVisible=e}}},[e("div",{staticClass:"end-dialog-content"},[e("div",{staticClass:"dialog-icon"},[e("i",{staticClass:"el-icon-check"})]),e("div",{staticClass:"dialog-message"},[e("p",[t._v("诊断已完成，感谢您的信任！")]),e("p",[t._v("恭喜您康复！祝您身体健康！")])])]),e("div",{staticClass:"rate-container"},[e("div",{staticClass:"rate-title"},[t._v("给此次治疗做出您的评价：")]),e("el-rate",{staticStyle:{"justify-content":"center","font-size":"24px"},attrs:{"show-text":"","text-color":"#ff9900","score-template":"{value}分",colors:["#99A9BF","#F7BA2A","#FF9900"],texts:["很差","较差","一般","较好","很好"]},model:{value:t.score,callback:function(e){t.score=e},expression:"score"}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.cancelEndDialog}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.confirmEndDialog}},[t._v("确认并提交评分")])],1)]),e("el-dialog",{attrs:{title:"回复评论",visible:t.replyShow,width:"30%"},on:{"update:visible":function(e){t.replyShow=e}}},[e("el-form",{attrs:{model:t.replyForm}},[e("el-form-item",[e("el-input",{staticStyle:{width:"95%","margin-left":"10px"},attrs:{type:"textarea",placeholder:"回复："+t.replyForm.replyedName,autocomplete:"off"},model:{value:t.replyForm.content,callback:function(e){t.$set(t.replyForm,"content",e)},expression:"replyForm.content"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.replyShow=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submitReply}},[t._v("回复")])],1)],1)],1)},r=[],o=(s(1454),s(8443)),a=s(1009),n={components:{},data(){return{recordId:parseInt(localStorage.getItem("recordId")),record:{},diagnosis:null,score:5,drawer:!1,endDialogVisible:!1,commentForm:{recordId:"",userId:"",role:0,content:"",username:""},replyForm:{commentId:"",userId:"",role:0,content:"",replyedName:"",username:""},commentsList:[],replyShow:!1}},computed:{userInfo(){return this.$store.state.user.userInfo}},async mounted(){try{this.record=await(0,o.se)(this.recordId)||{},this.commentForm.recordId=this.recordId,this.commentForm.userId=this.userInfo?.userId||"",this.commentForm.username=this.userInfo?.username||"",this.commentForm.role=this.userInfo?.role||0,this.replyForm.userId=this.userInfo?.userId||"",this.replyForm.username=this.userInfo?.username||"",this.replyForm.role=this.userInfo?.role||0,1===this.userInfo?.role&&await this.comment()}catch(t){console.error("获取病历详情失败:",t),this.$message.error("获取病历详情失败，请稍后再试")}},methods:{async goBack(){this.$bus.$emit("refresh-record-list"),this.$router.go(-1),localStorage.removeItem("recordId")},async fetchComments(){try{const t=await(0,a.SY)(this.recordId)||[];this.commentsList=t.map((t=>({...t,showAllReplies:!1})))}catch(t){console.error("获取评论列表失败:",t),this.$message.error("获取评论失败，请稍后再试"),this.commentsList=[]}},endDialog(){this.endDialogVisible=!0},cancelEndDialog(){this.endDialogVisible=!1},async confirmEndDialog(){try{await(0,o.vL)({recordId:this.recordId,status:3,score:this.score}),this.record.status=3,this.record.score=this.score,this.$message.success("感谢您的评价!"),this.endDialogVisible=!1,setTimeout((()=>{this.goBack()}),1e3)}catch(t){console.error("提交评分失败:",t),this.$message.error("评分提交失败，请稍后再试")}},async comment(){await this.fetchComments(),this.drawer=!0},async notice(){await(0,a.p8)({...this.commentForm,content:`请${this.record.doctorName}及时查看病历`}),this.$message.success("通知成功!"),await this.fetchComments()},async submitComment(){await(0,a.p8)(this.commentForm),this.$message.success("发送成功!"),this.commentForm.content="",await this.fetchComments()},showReply(t){this.replyShow=!this.replyShow,this.replyShow?(this.replyForm.commentId=t.commentId,this.replyForm.replyedName=t.username):(this.replyForm.commentId="",this.replyForm.replyedName="")},async submitReply(){await(0,a.wN)(this.replyForm),this.$message.success("回复成功!"),this.replyForm.content="",this.replyForm.username="",this.replyForm.commentId="",this.replyShow=!1,await this.fetchComments()},toggleReplies(t){t.showAllReplies=!t.showAllReplies},deleteCommentById(t){this.$confirm("是否删除该评论?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{t.recordId?await(0,a.Tu)(t.commentId):await(0,a.eL)(t.replyId),this.$message.success("删除成功!"),await this.fetchComments()}))}}},c=n,l=s(1656),d=(0,l.A)(c,i,r,!1,null,"4cd542e1",null),m=d.exports},1009:function(t,e,s){s.d(e,{SY:function(){return o},Tu:function(){return a},eL:function(){return c},p8:function(){return r},wN:function(){return n}});var i=s(5720);function r(t){return(0,i.Ay)({url:"/comment",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("发布评论失败:",t),Promise.reject(t))))}function o(t){const e=t?{url:`/comment/${t}`,method:"get"}:{url:"/comment",method:"get"};return(0,i.Ay)(e).catch((t=>((0,i.tq)(t)||console.error("获取评论列表失败:",t),Promise.reject(t))))}function a(t){return(0,i.Ay)({url:`/comment/delete/${t}`,method:"get"}).catch((t=>((0,i.tq)(t)||console.error("删除评论失败:",t),Promise.reject(t))))}function n(t){return(0,i.Ay)({url:"/reply",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("回复评论失败:",t),Promise.reject(t))))}function c(t){return(0,i.Ay)({url:`/reply/delete/${t}`,method:"get"}).catch((t=>((0,i.tq)(t)||console.error("删除回复失败:",t),Promise.reject(t))))}},8443:function(t,e,s){s.d(e,{$1:function(){return o},EF:function(){return l},a1:function(){return a},se:function(){return n},vL:function(){return c}});var i=s(5720);const r={info:new Map,timestamp:0,EXPIRY:3e5,isExpired(){return Date.now()-this.timestamp>this.EXPIRY},reset(){this.info.clear(),this.timestamp=0}};function o(t){return r.reset(),(0,i.Ay)({url:"/record/add",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("添加病历失败:",t),Promise.reject(t))))}function a(t){return(0,i.Ay)({url:"/record/page",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("获取病历列表失败:",t),Promise.reject(t))))}function n(t){return t?r.info.has(t)&&!r.isExpired()?Promise.resolve(r.info.get(t)):(0,i.Ay)({url:`/record/${t}`,method:"get",retryTimes:2,retryDelay:1e3,timeout:1e4}).then((e=>(e&&(r.info.set(t,e),r.timestamp=Date.now()),e))).catch((e=>((0,i.tq)(e)||(console.error(`获取病历 ${t} 失败:`,e),r.info.delete(t)),Promise.reject(e)))):Promise.reject(new Error("记录ID不能为空"))}function c(t){return t&&t.recordId?r.info.delete(t.recordId):r.reset(),(0,i.Ay)({url:"/record/update",method:"post",data:t}).catch((t=>((0,i.tq)(t)||console.error("更新病历失败:",t),Promise.reject(t))))}function l(t,e=5){return(0,i.Ay)({url:"/record/recommend",method:"post",data:{diagnosisText:t,limit:e}}).catch((t=>((0,i.tq)(t)||console.error("获取诊断推荐失败:",t),Promise.reject(t))))}},6319:function(t,e,s){var i=s(8551),r=s(9539);t.exports=function(t,e,s,o){try{return o?e(i(s)[0],s[1]):e(s)}catch(a){r(t,"throw",a)}}},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},6279:function(t,e,s){var i=s(6840);t.exports=function(t,e,s){for(var r in e)i(t,r,e[r],s);return t}},9462:function(t,e,s){var i=s(9565),r=s(2360),o=s(6699),a=s(6279),n=s(8227),c=s(1181),l=s(5966),d=s(7657).IteratorPrototype,m=s(2529),u=s(9539),p=n("toStringTag"),f="IteratorHelper",h="WrapForValidIterator",v=c.set,y=function(t){var e=c.getterFor(t?h:f);return a(r(d),{next:function(){var s=e(this);if(t)return s.nextHandler();if(s.done)return m(void 0,!0);try{var i=s.nextHandler();return s.returnHandlerResult?i:m(i,s.done)}catch(r){throw s.done=!0,r}},return:function(){var s=e(this),r=s.iterator;if(s.done=!0,t){var o=l(r,"return");return o?i(o,r):m(void 0,!0)}if(s.inner)try{u(s.inner.iterator,"normal")}catch(a){return u(r,"throw",a)}return r&&u(r,"normal"),m(void 0,!0)}})},g=y(!0),_=y(!1);o(_,p,"Iterator Helper"),t.exports=function(t,e,s){var i=function(i,r){r?(r.iterator=i.iterator,r.next=i.next):r=i,r.type=e?h:f,r.returnHandlerResult=!!s,r.nextHandler=t,r.counter=0,r.done=!1,v(this,r)};return i.prototype=e?g:_,i}},713:function(t,e,s){var i=s(9565),r=s(9306),o=s(8551),a=s(1767),n=s(9462),c=s(6319),l=n((function(){var t=this.iterator,e=o(i(this.next,t)),s=this.done=!!e.done;if(!s)return c(t,this.mapper,[e.value,this.counter++],!0)}));t.exports=function(t){return o(this),r(t),new l(a(this),{mapper:t})}},1701:function(t,e,s){var i=s(6518),r=s(713),o=s(6395);i({target:"Iterator",proto:!0,real:!0,forced:o},{map:r})},1454:function(t,e,s){s(1701)}}]);